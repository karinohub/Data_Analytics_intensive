# Проект 06

Работа с условными операторами и подзапросами

<h3 id="задание">Задание</h3>

В этом проекте будем использовать в качестве источника данных тот же .csv файл, что и на прошлой неделе, чтобы подробнее разобраться в отдельных категориях товаров. 
Ранее мы выяснили, что самой популярной категорией товаров в нашем интернет-магазине являются видеокарты. Давай проверим, так ли это было всегда, сколько денег они приносят от общей выручки магазина, в какие часы их покупают чаще всего и можем ли мы предложить этим покупателям еще какие-то дополнительные товары.
1. Укажи файл da_project05_purch.csv из папки datasets в качестве источника при импорте в sqliteonline.com
2. Вычисли выручку по категории computers.components.videocards по месяцам. Чтобы не указывать название явно, можно использовать конструкцию like '%videocard%', где % указывают на то, что вокруг этой строки могут находиться другие символы.
3. Вычисли общую выручку по месяцам, можно переиспользовать предыдущий без фильтра по категории. Для того, чтобы закомментировать строку и не удалять ее из запроса, укажи двойное тире "--" перед строкой.
4. Получив значение общей суммы и суммы в конкретной категории, вычисли %, сколько составляют продажи видеокарт от общей выручки. Для вычисления % можно использовать Excel/калькулятор и любые другие подручные средства. 
5. Так как в последние месяцы видеокарты начали составлять значительную долю выручки нашего онлайн-магазина, необходимо выяснить, какой бренд пользуется наибольшей популярностью. Для этого вычисли количество покупок в категории computers.components.videocards, используя группировку по brand.
6. Давай посмотрим, какие еще категории товаров покупают пользователи, которые купили видеокарты этого бренда. В подзапросе с условием используй поиск по user_id с покупками в нужной категории и бренде.
7. Мы выяснили, какие товары пользуются популярностью в нашем интернет-магазине и хотим запустить акцию для покупателей "Счастливый час!", когда при покупке любой видеокарты пользователь получает скидку на товар из п. 6. Необходимо выяснить, сколько покупок совершалось в какой час в категории computers.components.videocards. Для создания колонки с часами используй команду strftime()
9. Пронумеруй от 1 до 5 и запиши в файл da_project06.txt ответы на следующие вопросы:
    1. какой тренд имеет доля выручки видеокарт от общих продаж: падает или растет?
    2. сколько % от общей выручки составили продажи видеокарт в феврале 2021 года, напиши с округлением до 1 знака после запятой
    3. какой бренд самый популярный
    4. перечисли через запятую все подкатегории товаров computers, которые покупяют вместе с видеокартами самого популярного бренда. 
    5. предложи топ 2 часа, в которые чаще всего покупали видеокарты, укажи через запятую.

<h3 id="дополнительное-задание">*Дополнительное задание</h3>

Как правило, обычно недостаточно знать самые популярные позиции, т.к. они могут быть дешевыми и иметь много продаж, но в сумме приносить не так много денег. Еще одной значимой метрикой для пользователя явлеяется средний чек. В этом задании необходимо вычислить средний чек пользователя, который покупал в нашем интернет-магазине видеокарту vs средний чек пользователя, который видеокарту не покупал. Сделать это необходимо в одном запросе, используя вложенную структуру. Предлагаемый вариант решения: 
1. промаркировать пользователей по признаку "купил/не купил", для этого можно использовать конструкцию CASE WHEN THEN. В таком случае промаркируется одна или N строчек, когда пользователь совершал покупку, подходящую под наши условия. Для того, чтобы промаркировать пользователя, можно при дальнейшней группировке использовать maх() по этому признаку, и тогда если у нас хотя бы в одной строке была 1, то у пользователя будет 1.
2. посчитать на каждого пользователя средний чек, используя сумму его трат за все время и количество покупок. На этом же этапе при группировке по пользователям используй maх() из п.1
3. используя группировку по признаку "купил/не купил", вычисли средний чек по всем пользователям этой группы.

В файле da_project06_extra.txt впиши через запятую с округлением до двух знаков, какой средний чек у купивших видеокарту и не купивших, укажи категории. Дополнительно добавь в файл текст свой запроса.
