# Проект 07

Работа с несколькими источниками данных


В этом проекте мы продолжим исследовать поведение пользователей нашего интернет-магазина. Ранее мы базировались только на данных о совершенных покупках (event_type = ‘purchase’). Теперь к покупкам у нас есть еще другие действия, которые можно было совершить: ‘view’ - просмотр страницы, ‘cart’ - переход в корзину.


<h3 id="задание">Задание</h3>

1. Загрузи файлы da_project05_purch.csv и da_project05_events.csv из папки datasets к этому проекту. В файле da_project05_purch.csv, как и ранее, хранится информация о покупках в интернет-магазине, в файле da_project05_events.csv - о просмотрах страниц и переходах в корзину.

2. Так как все события, включая платежи, пишутся в потоке, в таблицах хранятся одинаковые столбцы, мы можем объединить и получить всю последовательность действий наших пользователей. Используя объединение в качестве подзапроса, вычисли, сколько строк хранится в обоих таблицах всего.

3. Переиспользуй подзапрос с объединением из прошлого задания и вычисли количество уникальных пользователей на сайте по месяцам. Этот показатель называется MAU - Monthly Active Users — количество уникальных пользователей в приложении или онлайн-сервисе за месяц без учета повторных сессий.

4. Так как не все пользователи обладают одинаковой информативностью, мы можем через пересечение таблиц поработать с теми, кто совершал покупки. Для этого необходимо пересечеть таблицу со всеми действиями и таблицу с покупками по ключам. Обрати внимание, что кроме ID клиента есть еще ID сессии - сеанс пользовательской активности на сайте. Когда пользователь выходит из личного кабинета или долго не совершает никаких действий, текущая сессия считается завершенной и при следующем заходе начнется новая. В качестве параметров используй user_id и user_session. Т.к. не все из пользователей могли совершать покупки (как мы выяснили в п.2), лучше использовать FULL JOIN, иначе часть данных потеряется.

5. Вычисли, сколько строк получилось в объединенной таблице.

6. Далее посмотрим, сколько уникальных пользователей ушли с сайта не совершив покупку. В нашем случае это означает, что их нет в таблице платежей. Используя в условии table_purch.user_id is null, вычисли количество уникальных пользователей из table_events

7. Вычислим, сколько раз в среднем покупателю нужно посмотреть карточку товара, чтобы его купить. Этот параметр дает нам понять, сколько в среднем кликов на сайте должен сделать пользователь, чтобы купить интересующий его товар. 

8. Переиспользуй запрос из п.7, добавив в него в группировку категорию товара и вычисли, сколько кликов нужно для покупки товаров из всех подкатегорий 'computers.', для поиска можно использовать конструкцию LIKE '%computers%', как мы делали ранее.

Сверьте результаты в команде и соберите в общий .txt файл ответы на следующие вопросы:

   1. сколько строк получилось при объединении двух таблиц через UNION ALL
   2. сколько составил показатель MAU в самый прибыльный месяц, январь 2021 года
   3. сколько строк получилось при пересечении двух таблиц через FULL JOIN 
   4. сколько уникальных пользователей ушли с сайта не совершив ни одной покупки за весь период
   5. сколько в среднем требуется просмотров для покупки товара в категории computers.components.videocards, запиши с точностью до двух знаков 
   6. какую подкатегорию из 'computers.' выбирают дольше всего (нужно больше всего просмотров) 


<h3 id="дополнительное-задание">*Дополнительное задание</h3>

Кроме знаний об активной месячной аудитории важно так же понимать, сколько из этих пользователей совершает покупки - **%PU** - paying users - пользователи, которые заплатили. В этом задании мы попробуем расчитать %PU для нашей аудитории.
Далее попробуем расчитать %PU, основываясь на флагах, совершал пользователь покупку в этом месяце или нет. Алгоритм аналогичный бонусному заданию в проекте 6. Нумерацию действий можно использовать для ориентира по уровням подзапросов:
1. заполни пропуски в столбцах user_id и month
2. промаркируй пользователей флагами по совершению покупки. В данном случае, если пользователь есть в таблице платежей = 1, если нет = 0. Когда возьмем при группировке max() по этому признаку - получим однозначный флаг на каждого пользователя. Не забудь, что в группировке должен быть еще ммесяц.
3. для посчета общего количества пользователей можно воспользоваться функцией count(), а для подсчета количества покупателей используй sum() по признаку флага из п.2: суммируя все единички, ты как раз получишь количество пользователей, совершивших покупку в этом месяце.
4. выгрузи результаты: нажми на Export в верхнем меню и выбери CSV. В качестве разделителей укажи ';'
5. открой результаты в Excel и вычисли в отдельной колонке %PU - подели количество плательщиков на общее количество пользователей. 
6. добавь строкой 1 заголовки для таблицы: Month, Total, Payers, PU
7. построй линейную диаграмму для PU по месяцам и сохрани файл под названием da_project06_extra.xlsx 
